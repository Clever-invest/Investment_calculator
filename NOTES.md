# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏ ‚Äî Flip Calculator

> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –∏ –≤–∞–∂–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∑–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ—É—Ç–æ–≤
```
/           ‚Üí ProtectedRoute ‚Üí App (–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä)
/login      ‚Üí AuthPage (–≤—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
/reset-password ‚Üí ResetPasswordPage
/v1         ‚Üí Redirect to /
```

### ProtectedRoute
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç-–æ–±—ë—Ä—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:
1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç loader –ø–æ–∫–∞ `initialized === false`
2. –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/login` –µ—Å–ª–∏ `user === null`
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –ø—É—Ç—å –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

### AuthInitializer
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç auth –æ–¥–∏–Ω —Ä–∞–∑ –≤ Router.tsx, –Ω–µ –≤ –∫–∞–∂–¥–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ.

---

## üìä Off-Plan —Ä–∞—Å—á—ë—Ç—ã

### –§–æ—Ä–º—É–ª–∞ –ø—Ä–∏–±—ã–ª–∏

**Secondary (–≤—Ç–æ—Ä–∏—á–∫–∞):**
```
totalCosts = purchasePrice + –∫–æ–º–∏—Å—Å–∏–∏ + —Ä–µ–º–æ–Ω—Ç + —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
netProceeds = salePrice - –∫–æ–º–∏—Å—Å–∏–∏ –ø—Ä–æ–¥–∞–≤—Ü–∞
profit = netProceeds - totalCosts
```

**Off-Plan:**
```
totalCosts = paidAmount + –∫–æ–º–∏—Å—Å–∏–∏ + —Ä–µ–º–æ–Ω—Ç + —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
remainingDebt = ‚àë(–ø–ª–∞—Ç–µ–∂–µ–π –¥–æ –¥–∞—Ç—ã –ø—Ä–æ–¥–∞–∂–∏)
netProceeds = salePrice - –∫–æ–º–∏—Å—Å–∏–∏ –ø—Ä–æ–¥–∞–≤—Ü–∞ - remainingDebt
profit = netProceeds - totalCosts
```

### –î–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏
```
saleDate = today + renovationMonths + listingMonths
```

–ü–ª–∞—Ç–µ–∂–∏ –ø–æ –≥—Ä–∞—Ñ–∏–∫—É —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ —ç—Ç–æ–π –¥–∞—Ç–µ.

---

## üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### Supabase —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- `params` ‚Äî JSONB, —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ CalculatorParams
- `calculations` ‚Äî JSONB, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–æ–≤
- `coordinates` ‚Äî JSONB, lat/lon –¥–ª—è –∫–∞—Ä—Ç—ã
- `images` ‚Äî TEXT[], URLs –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ CalculatorParams –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ JSONB.
**–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.**

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º nullish coalescing:
```typescript
bedrooms: property.bedrooms ?? 1,
bathrooms: property.bathrooms ?? 1,
```

---

## üì± –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### MetricsGrid
- Desktop: grid 4 –∫–æ–ª–æ–Ω–∫–∏
- Mobile compact: grid 2x2 (–Ω–µ —Å–∫—Ä–æ–ª–ª)

### DetailedBreakdown
- Desktop: –ø–æ–ª–Ω—ã–µ –ª–µ–π–±–ª—ã + —Ñ–æ—Ä–º—É–ª—ã
- Mobile: –∫–æ—Ä–æ—Ç–∫–∏–µ –ª–µ–π–±–ª—ã, —Ñ–æ—Ä–º—É–ª—ã —Å–∫—Ä—ã—Ç—ã

### CalcRow –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```tsx
<CalcRow
  label="DLD/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (4%)"
  shortLabel="DLD 4%"
  value={formatCurrency(value)}
  formula="500,000 √ó 4%"  // —Å–∫—Ä—ã—Ç–æ –Ω–∞ mobile
  isAdd
  isMobile={isMobile}
/>
```

---

## üßÆ IRR —Ä–∞—Å—á—ë—Ç

### –§–æ—Ä–º—É–ª–∞
```
IRR = ((netProceeds / totalCosts)^(12/months) - 1) √ó 100%
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- –ê–Ω–Ω—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- –ü—Ä–∏ —Å—Ä–æ–∫–µ < 12 –º–µ—Å: IRR > ROI
- –ü—Ä–∏ —Å—Ä–æ–∫–µ > 12 –º–µ—Å: IRR < ROI
- –ü—Ä–∏ —Å—Ä–æ–∫–µ = 12 –º–µ—Å: IRR ‚âà ROI

---

## üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –º–µ—Ç—Ä–∏–∫

```javascript
// tailwind.config.js
colors: {
  profit: { 50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 600: '#16a34a' },
  roi:    { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 600: '#2563eb' },
  irr:    { 50: '#faf5ff', 100: '#f3e8ff', 200: '#e9d5ff', 600: '#9333ea' },
  timing: { 50: '#fefce8', 100: '#fef9c3', 200: '#fef08a', 600: '#ca8a04' },
}
```

---

## üîÑ Zustand Stores

### calculatorStore
- `params` ‚Äî —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
- `coordinates` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ä–µ–∫—Ç–∞
- Persist –≤ localStorage

### propertiesStore
- `properties` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- `isSynced` ‚Äî —Ñ–ª–∞–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –æ–±–ª–∞–∫–æ–º
- –ú–µ—Ç–æ–¥—ã: addProperty, deleteProperty, syncWithCloud

### authStore
- `user`, `session` ‚Äî –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `initialized` ‚Äî —Ñ–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ú–µ—Ç–æ–¥—ã: initialize, signOut

### uiStore
- `activeTab` ‚Äî —Ç–µ–∫—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞
- `editingWeek` ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–∞—è –Ω–µ–¥–µ–ª—è –≤ EarlySaleTable
- `customMetrics` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

---

## üìÑ PDF —ç–∫—Å–ø–æ—Ä—Ç

### –§–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
```
üìä –õ–∏—Å—Ç —Å–¥–µ–ª–∫–∏ —Ñ–ª–∏–ø–ø–∏–Ω–≥–∞
Marina Bay Tower, Apt 2501
üìç Dubai Marina ‚Ä¢ –ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã ‚Ä¢ üõèÔ∏è 2 BR ‚Ä¢ üöø 1 Bath ‚Ä¢ üè¢ –í—Ç–æ—Ä–∏—á–∫–∞
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
1. –ú–µ—Ç—Ä–∏–∫–∏ (4 –∫–∞—Ä—Ç–æ—á–∫–∏)
2. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
3. –ó–∞—Ç—Ä–∞—Ç—ã –∏ –≤—ã—Ä—É—á–∫–∞ (—Ç–∞–±–ª–∏—Ü–∞)
4. –ì—Ä–∞—Ñ–∏–∫ —Å–¥–µ–ª–∫–∏
5. –ö–∞—Ä—Ç–∞ –ª–æ–∫–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã (Vitest)
- –†–∞—Å—á—ë—Ç—ã: core.ts, money.ts
- –£—Ç–∏–ª–∏—Ç—ã: format.ts
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: shallow render

### E2E —Ç–µ—Å—Ç—ã (Playwright)
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è flow
- –°–æ–∑–¥–∞–Ω–∏–µ/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
- –≠–∫—Å–ø–æ—Ä—Ç PDF
- Mobile responsive

---

## ‚ö° Performance

### Code Splitting
```typescript
const App = lazy(() => import('./App'));
const AuthPage = lazy(() => import('./pages/AuthPage'));
```

### Skeleton Loaders
- CalculatorSkeleton –¥–ª—è App
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è lazy load

### PWA Caching
- Workbox –¥–ª—è Service Worker
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: OSM tiles, Supabase API
- Offline-first –¥–ª—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
